<!-- HERO -->
<section class="hero">
    <div class="hero__bg">
        <span class="blob blob--1"></span>
        <span class="blob blob--2"></span>
    </div>

    <div class="hero__content container">
        <h1 class="hero__title">
            Find your ride.
            <span>Search & book instantly.</span>
        </h1>
        <p class="hero__subtitle">
            Filter by location, brand, type, and more. Get only cars available in your dates.
        </p>

        <!-- Search Form -->
        <form class="quick-search quick-search--tight" (ngSubmit)="searchVehicles()">
            <select [(ngModel)]="filters.location_id" name="location_id" class="control--sm">
                <option [ngValue]="null">Any location</option>
                <option *ngFor="let loc of (locations$ | async)" [ngValue]="loc.id">
                    {{ loc.location_name }} — {{ loc.address }}
                </option>
            </select>

            <!-- start: input + small clear -->
            <div class="field-with-clear">
                <input class="control--sm" type="datetime-local" [(ngModel)]="filters.start" name="start" />
                <button type="button" class="clear clear--xs" (click)="filters.start = ''">×</button>
            </div>

            <!-- end: input + small clear -->
            <div class="field-with-clear">
                <input class="control--sm" type="datetime-local" [(ngModel)]="filters.end" name="end" />
                <button type="button" class="clear clear--xs" (click)="filters.end = ''">×</button>
            </div>

            <button class="btn btn--primary btn--sm" type="submit">Search</button>
        </form>

        <div *ngIf="errorMsg" class="form-error" style="margin-top:.4rem;">
            {{ errorMsg }}
        </div>

        <!-- Optional Filters -->
        <div class="quick-search quick-search--compact">
            <!-- Brand -->
            <div class="select-wrap">
                <select class="control--sm" [(ngModel)]="filters.brand_id" (change)="onBrandChange()" name="brand_id">
                    <option [ngValue]="null">Any brand</option>
                    <option *ngFor="let brand of brands" [ngValue]="brand.id">
                        {{ brand.brand_name }}
                    </option>
                </select>
                <button type="button" class="clear clear--xs" (click)="clearBrand()">×</button>
            </div>

            <!-- Model -->
            <div class="select-wrap">
                <select class="control--sm" [(ngModel)]="filters.model_id" name="model_id" [disabled]="!models.length">
                    <option [ngValue]="null">Any model</option>
                    <option *ngFor="let model of models" [ngValue]="model.id">
                        {{ model.model_name }}
                    </option>
                </select>
                <button type="button" class="clear clear--xs" (click)="clearModel()"
                    [disabled]="!models.length">×</button>
            </div>

            <!-- Vehicle Type -->
            <div class="select-wrap">
                <select class="control--sm" [(ngModel)]="selectedVehicleTypeId" (change)="onVehicleTypeChange()"
                    name="vehicle_type_id">
                    <option [ngValue]="null">Any type</option>
                    <option *ngFor="let t of vehicleTypes" [ngValue]="t.id">
                        {{ t.vehicle_type }}
                    </option>
                </select>
                <button type="button" class="clear clear--xs" (click)="clearVehicleType()">×</button>
            </div>

            <!-- Engine Type -->
            <div class="select-wrap">
                <select class="control--sm" [(ngModel)]="selectedEngineTypeId" (change)="onEngineTypeChange()"
                    name="engine_type_id">
                    <option [ngValue]="null">Any engine</option>
                    <option *ngFor="let e of engineTypes" [ngValue]="e.id">
                        {{ e.engine_type }}
                    </option>
                </select>
                <button type="button" class="clear clear--xs" (click)="clearEngineType()">×</button>
            </div>
        </div>

        <!-- Clear ALL -->


        <div class="quick-search quick-search--compact mt-6">
            <input class="control--sm" type="number" [(ngModel)]="filters.price_min" name="price_min"
                placeholder="Min Price" />
            <input class="control--sm" type="number" [(ngModel)]="filters.price_max" name="price_max"
                placeholder="Max Price" />
            <input class="control--sm" type="number" [(ngModel)]="filters.seats_min" name="seats_min"
                placeholder="Min Seats" />
            <input class="control--sm" type="number" [(ngModel)]="filters.seats_max" name="seats_max"
                placeholder="Max Seats" />
        </div>

        <button type="button" class="btn btn--ghost btn--sm mt-6" (click)="clearAll()">Clear all filters</button>
    </div>
</section>

<!-- RESULTS -->
<section class="section container" *ngIf="vehicles.length > 0">
    <div class="section__head">
        <h2>Available vehicles</h2>
    </div>

    <div class="cards">
        <article class="card" *ngFor="let v of vehicles">
            <div class="card__media">
                <div class="img-skeleton">{{ v.brand }} {{ v.model }}</div>
            </div>
            <div class="card__body">
                <h3>{{ v.brand }} {{ v.model }}</h3>
                <p>
                    {{ v.engine_type }} • {{ v.seats }} seats • {{ v.vehicle_type }}
                </p>
                <div class="price">€{{ v.price_per_day }} <span>/ day</span></div>
                <div class="meta">Available: {{ v.available_count }}</div>
                <a class="btn btn--tiny" [routerLink]="['/vehicles', v.vehicle_id]" [queryParams]="{
                    location_id: filters.location_id || null,
                    start: filters.start || null,
                    end: filters.end || null
                }">
                    View
                </a>
            </div>
        </article>
    </div>
</section>